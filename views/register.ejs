<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register - GeeksEnergy</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
      integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr"
      crossorigin="anonymous"
    />
  </head>
  <style>
    body {
      padding: 0;
      margin: 0;
    }
    .register_outer {
      width: 360px;
      max-width: 100%;
    }
    .logo_outer {
      text-align: center;
    }
    .logo_outer img {
      width: 120px;
      margin-bottom: 40px;
    }
  </style>
  <body>
    <div class="container-fluid">
      <div
        class="row d-flex justify-content-center align-items-center m-0"
        style="height: 100vh"
      >
        <div class="register_outer">
          <!-- <div class="col-md-12 logo_outer">
            <img
              src="https://bootstrapfriendly.com/static/images/bootstrapfriendly_logo.png"
              alt="GeeksEnergy Logo"
            />
          </div> -->
          <form
            action="/register"
            method="post"
            id="register"
            autocomplete="off"
            class="bg-light border p-3"
            onsubmit="return validateForm()"
          >
            <div class="form-row">
              <h4 class="title my-3">Register for an Account</h4>

              <!-- Name Fields -->
              <div class="col-12">
                <div
                  id="formErr"
                  class="text-danger d-flex justify-content-center"
                >
                  <% if (message) { %><%= message %><% } %>
                </div>

                <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text"
                      ><i class="fas fa-user"></i
                    ></span>
                  </div>
                  <input
                    name="firstName"
                    type="text"
                    class="form-control"
                    id="firstName"
                    placeholder="First Name"
                    value="<%= user.firstName || '' %>"
                    required
                  />
                </div>
                <div id="firstNameErr" class="text-danger"></div>
              </div>

              <div class="col-12">
                <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text"
                      ><i class="fas fa-user"></i
                    ></span>
                  </div>
                  <input
                    name="lastName"
                    type="text"
                    class="form-control"
                    id="lastName"
                    value="<%= user.lastName || '' %>"
                    placeholder="Last Name"
                    required
                  />
                </div>
                <div id="lastNameErr" class="text-danger"></div>
              </div>

              <!-- Email Field -->
              <div class="col-12">
                <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text"
                      ><i class="fas fa-envelope"></i
                    ></span>
                  </div>
                  <input
                    name="email"
                    type="email"
                    class="form-control"
                    id="address"
                    value="<%= user.email || '' %>"
                    placeholder="Email"
                    required
                  />
                </div>
                <div id="addressErr" class="text-danger"></div>
              </div>

              <!-- Phone Number Field -->
              <div class="col-12">
                <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text"
                      ><i class="fas fa-phone"></i
                    ></span>
                  </div>
                  <input
                    name="phone"
                    type="text"
                    class="form-control"
                    id="phoneno"
                    value="<%= user.phone || '' %>"
                    placeholder="Phone Number"
                    required
                  />
                </div>
                <div id="phonenoErr" class="text-danger"></div>
              </div>

              <div class="col-12">
                <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text"
                      ><i class="fas fa-briefcase"></i
                    ></span>
                  </div>
                  <input
                    name="profession"
                    type="text"
                    class="form-control"
                    id="profession"
                    value="<%= user.profession || '' %>"
                    placeholder="Profession"
                    required
                  />
                </div>
              </div>

              <!-- Password Field with Eye Button -->
              <div class="col-12">
                <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text"
                      ><i class="fas fa-lock"></i
                    ></span>
                  </div>
                  <input
                    name="password"
                    type="password"
                    class="form-control"
                    id="password"
                    value="<%= user.password || '' %>"
                    placeholder="Password"
                    required
                  />
                  <div class="input-group-append">
                    <span
                      class="input-group-text"
                      onclick="togglePasswordVisibility('password')"
                    >
                      <i id="password-eye" class="fas fa-eye"></i>
                    </span>
                  </div>
                </div>
                <div id="passwordErr" class="text-danger"></div>
              </div>

              <!-- Confirm Password Field with Eye Button -->
              <div class="col-12">
                <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text"
                      ><i class="fas fa-lock"></i
                    ></span>
                  </div>
                  <input
                    name="confirmPassword"
                    type="password"
                    class="form-control"
                    id="cpassword"
                    placeholder="Confirm Password"
                    required
                  />
                  <div class="input-group-append">
                    <span
                      class="input-group-text"
                      onclick="togglePasswordVisibility('cpassword')"
                    >
                      <i id="cpassword-eye" class="fas fa-eye"></i>
                    </span>
                  </div>
                </div>
                <div id="cpasswordErr" class="text-danger"></div>
              </div>

              <div class="col-12">
                <button class="btn btn-primary btn-block" type="submit">
                  Register
                </button>
              </div>
              <div class="col-sm-12 pt-3 text-right">
                <p>Already have an account? <a href="/login">Login here</a></p>
              </div>
            </div>
            <div id="message" class="text-danger mt-2"></div>
          </form>
        </div>
      </div>
    </div>

    <script>
      function validateForm() {
        resetErrors();

        var firstName = document.getElementById("firstName").value.trim();
        var lastName = document.getElementById("lastName").value.trim();
        var email = document.getElementById("address").value.trim();
        var phoneNumber = document.getElementById("phoneno").value.trim();
        var profession = document.getElementById("profession").value.trim();
        var password = document.getElementById("password").value.trim();
        var confirmPassword = document.getElementById("cpassword").value.trim();

        if (
          !areAllFieldsFilled(
            firstName,
            lastName,
            email,
            phoneNumber,
            password,
            confirmPassword,
            profession
          )
        ) {
          setMessage("Please fill in all fields.");
          return false;
        }

        if (!isValidName(firstName, 3)) {
          setError(
            "firstName",
            "First Name must be at least three characters."
          );
          return false;
        }

        if (!isValidName(lastName, 3)) {
          setError("lastName", "Last Name must be at least three characters.");
          return false;
        }

        if (!isValidEmail(email)) {
          setError("address", "Invalid email address.");
          return false;
        }

        if (!isValidPhoneNumber(phoneNumber)) {
          setError("phoneno", "Invalid phone number (must be 10 digits).");
          return false;
        }

        if (!isValidPassword(password)) {
          setError(
            "password",
            "Password must be at least 8 characters long with at least one uppercase, one lowercase, and one special character."
          );
          return false;
        }

        if (password !== confirmPassword) {
          setError("cpassword", "Password and Confirm Password must match.");
          return false;
        }

        return true;
      }

      function setMessage(text) {
        document.getElementById("message").innerText = text;
      }

      function setError(field, text) {
        document.getElementById(field + "Err").innerText = text;
      }

      function areAllFieldsFilled(
        firstName,
        lastName,
        email,
        phoneNumber,
        password,
        confirmPassword,
        profession
      ) {
        return (
          firstName &&
          lastName &&
          email &&
          phoneNumber &&
          password &&
          confirmPassword &&
          profession
        );
      }

      function isValidName(name, n) {
        return name.length >= n;
      }

      function isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
      }

      function isValidPhoneNumber(phoneNumber) {
        const phoneRegex = /^\d{10}$/;
        return phoneRegex.test(phoneNumber);
      }

      function isValidPassword(password) {
        const passwordRegex =
          /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
        return passwordRegex.test(password);
      }

      function resetErrors() {
        document
          .querySelectorAll(".text-danger")
          .forEach((field) => (field.innerText = ""));
      }

      // Toggle password visibility
      function togglePasswordVisibility(fieldId) {
        const passwordField = document.getElementById(fieldId);
        const eyeIcon = document.getElementById(fieldId + "-eye");

        if (passwordField.type === "password") {
          passwordField.type = "text";
          eyeIcon.classList.remove("fa-eye");
          eyeIcon.classList.add("fa-eye-slash");
        } else {
          passwordField.type = "password";
          eyeIcon.classList.remove("fa-eye-slash");
          eyeIcon.classList.add("fa-eye");
        }
      }
    </script>
  </body>
</html>
